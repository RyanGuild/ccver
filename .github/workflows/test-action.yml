name: Test CCVer Action on Docker Image

on:
  workflow_dispatch:
  workflow_run:
    workflows: [.github/workflows/docker.yml]
    types: [completed]
    branches: [ main, master ]

jobs:
  test-action:
    runs-on: ubuntu-latest
    steps:
    - name: Test CCVer Action - Get Version
      id: version
      uses: ryanguild/ccver@master
      with:
        ci: 'false'

    - name: Test CCVer Action - Generate Changelog
      id: changelog
      uses: ryanguild/ccver@master
      with:
        command: 'changelog'
        ci: 'false'

    - name: Test CCVer Action - Custom Format
      id: custom
      uses: ryanguild/ccver@master
      with:
        format: 'v{major}.{minor}.{patch}'
        ci: 'false'

    - name: Display Results
      run: |
        echo "Default version: ${{ steps.version.outputs.version }}"
        echo "Custom format version: ${{ steps.custom.outputs.version }}"
        echo "Changelog:"
        echo "${{ steps.changelog.outputs.changelog }}"

  test-docker:
    runs-on: ubuntu-latest
    steps:
    - name: Test Docker Image - Version
      run: docker run --rm -v "${GITHUB_WORKSPACE}:/github/workspace" ghcr.io/ryanguild/ccver --help

    - name: Test Docker Image - Get Version
      run: docker run --rm -v "${GITHUB_WORKSPACE}:/github/workspace" ghcr.io/ryanguild/ccver
